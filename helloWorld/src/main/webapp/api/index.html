<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>api/index.html</title>
</head>

<body>
    <div id="show"></div>
    <script>
        function makePage(aryData) {
            // [{id:??, first_name:??, last_name:??, email:??}]
            // -> table 형식.
            // table > thead, tbody> tr > th,td

            // let ul = document.createElement('ul');
            // aryData.forEach(function (item) {
            //     let li = document.createElement('li');
            //     let text = document.createTextNode(`${item.id} - ${item.first_name} - ${item.last_name}`);
            //     li.appendChild(text);
            //     ul.appendChild(li);
            // });
            // console.log(ul);
            // document.getElementsByTagName('body')[0].appendChild(ul);
            let field = ['ID', 'First_name', 'Last_name', 'Email', 'Gender'];
            let tbl = document.createElement('table');
            tbl.setAttribute('border', '1');
            let thd = document.createElement('thead');
            let tr = document.createElement('tr');
            field.forEach(function (item) {
                let th = document.createElement('th');
                let text = document.createTextNode(item);
                th.appendChild(text);
                tr.appendChild(th);
                thd.appendChild(tr);
            });
            tbl.appendChild(thd);

            // console.log(tbl);

            let tbd = document.createElement('tbody');
            aryData.forEach(function (item) {
                let tr = document.createElement('tr');
                for (let field in item) {
                    let td = document.createElement('td');
                    let text = document.createTextNode(`${item[field]}`);
                    td.appendChild(text);
                    tr.appendChild(td);
                    tbd.appendChild(tr);
                };
                tbl.appendChild(tbd);
            });
            document.getElementsByTagName('body')[0].appendChild(tbl);
        }

        // 보여줄 항목 정의.
        const fields = ['id', 'centerName', 'address', 'phoneNumber', 'sido', 'sigungu'];

        function showCenterList(data) {
            // 전체카운트 : data.currentCount : 284
            // 현재페이지 : data.page : 1 
            // 전체데이터 : data.data : 284건의 접종센터 정보.

            let table = document.createElement('table');
            table.setAttribute('border', '1');
            table.setAttribute('id', 'tbl');
            let thead = document.createElement('thead');
            let tbody = document.createElement('tbody');
            // table의 하위요소로 thead, tbody 추가
            table.append(thead, tbody);
            
            // thead 작성
            let tr = document.createElement('tr');
            fields.forEach(function (field) {
                let th = document.createElement('th');
                let text = document.createTextNode(field.toUpperCase());
                th.append(text);
                tr.append(th);
            });
            thead.append(tr);
            // tbody 작성.
            data.data.forEach(function (item) { // item: 데이터 건 수
                let tr = document.createElement('tr');
                fields.forEach(function (field) {
                    let td = document.createElement('td');
                    let text = document.createTextNode(item[field]);
                    td.append(text);
                    tr.append(td);
                });
                tbody.append(tr);
            }); 
            document.getElementById('show').append(table);
            
        }
        // Asynchoronous Javascript And Xml (ajax) 비 동기 방식 
        let url =
            `https://api.odcloud.kr/api/15077586/v1/centers?page=1&perPage=284&returnType=JSON&serviceKey=Hhzf9nj4Y3GDRxWoTz71fCvaCxy%2BL3hZms8opSyxhEDW0OHuhsxBQxJg8oNQDbdNl8kh8oLL%2B5aRTjfLqEtSzA%3D%3D`;
        let xhtp = new XMLHttpRequest();
        
        xhtp.onreadystatechange = function () {
            if (xhtp.readyState == 4 && xhtp.status == 200) {
                console.log('readyState : ' + xhtp.readyState);
                console.log('status : ' + xhtp.status);
                let data = JSON.parse(xhtp.responseText);
                console.log(data);

                // makePage(data);
                showCenterList(data);
            }
        } // on~은 이벤트 관련 속성
        xhtp.open('get', url);
        xhtp.send();
    </script>

</body>

</html>